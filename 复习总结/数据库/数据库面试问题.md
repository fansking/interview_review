## 数据库面试问题

### 隔离级别

1. 读未提交

   所有的事务都可以看到其他未提交事务的执行结果，导致如果其他事务回滚，本事务会读到错误的数据即脏读。

2. 读已提交

   一个事务可以看到已提交的事务修改过的数据，这导致交叉事务发生时，在同一个事务中执行相同的sql语句会读取不同的数据。

3. 重复读

   保证同一个事务多个实例在并发读取数据时看到相同的数据行，但可能出现幻读。

4. 序列化

   它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之,它是在每个读的数据行上加上共享锁。

### 事务特性

1、原子性(Atomicity)：事务中的全部操作在数据库中是不可分割的，要么全部完成，要么全部不执行。 

2、一致性(Consistency)：几个并行执行的事务，其执行结果必须与按某一顺序 串行执行的结果相一致。 

3、隔离性(Isolation)：事务的执行不受其他事务的干扰，事务执行的中间结果对其他事务必须是透明的。 

4、持久性(Durability):对于任意已提交事务，系统必须保证该事务对数据库的改变不被丢失，即使数据库出现故障。

### 联合索引

联合索引的数据结构同单列索引的数据结构，其节点实际上是按照索引顺序组合的元组（通俗的说法）

### mysql查询优化

1. 查询不需要的记录，使用limit
2. 多表关联时返回全部列，需要多少就请求多少
3. 重复查询相同的数据，常用数据放入缓存
4. **选择一个复杂的查询还是多个简单的查询？** 

### explain

```
 简称查看执行计划，使用explain关键字可以模拟优化器执行SQL查询语句，从而知道MySQL是如何处理SQL语句的,key代表用到了那些索引
```

### MVCC

mysql的乐观锁，事务并发版本控制

### 分布式锁

在分布式系统环境下，一个方法在同一时间只能被一个机器的一个线程执行；

基于数据库的实现方式的核心思想是：在数据库中创建一个表，表中包含**方法名**等字段，并在**方法名字段上创建唯一索引**，想要执行某个方法，就使用这个方法名向表中插入数据，成功插入则获取锁，执行完成后删除对应的行数据释放锁。

### mysql防注入

早期程序使用字符串拼接的方法生成sql查询语句，这导致恶意传入sql语句可以修改程序员开始的想法。

比如加入  ' or 1=1 --这样的字符串。

使用数据持久层提供的PreparedStatement，以参数的形式传入，工具会对传入参数做安全检查和反转义

### mysql主从复制

MySQL主服务器更新数据，执行命令，将会记录到自己的二进制日志里面，然后从服务器开始一个I/O线程，用于读取主服务器的已更新或以变化的二进制文件，前提是主服务器要给从服务器这个权限，读取以后，将数据放入中继日志里面，然后从服务器开启sql线程，负责读取中继日志里面的已更新或已更改的日志，然后再执行以更新的命令

### 读写分离

读写分离，基本的原理是让主数据库处理事务性增、改、删操作（INSERT、UPDATE、DELETE），而从数据库处理SELECT查询操作。数据库复制被用来把事务性操作导致的变更同步到集群中的从数据库。

因为数据库的“写”（写10000条数据到oracle可能要3分钟）操作是比较耗时的。
但是数据库的“读”（从oracle读10000条数据可能只要5秒钟）。
所以读写分离，解决的是，数据库的写入，影响了查询的效率。

### 分布式存储同步

1、 副本同步写
当 VBS 模块将写操作发送给指定主 OSD 时， 该 OSD 在写入本节点硬盘时，同时将写
操作同步到备 OSD， 同步过程中严格按照 IO 编号进行，保证了主 OSD 接收到的 IO 顺
序和同步到备 OSD 的 IO 顺序一致。 当主备 OSD 同时完成写操作时，才向应用返回操
作成功。

2、 读修复（Read Repair）
Read Repair 机制是指在读数据失败时，系统会判断错误类型，如果是磁盘扇区读取错误，
系统会自动从其他节点保存的副本读取数据，然后重新写入该副本数据到硬盘扇区错误
的节点， 从而保证数据副本总数不减少和副本间的数据一致性

### 实现秒杀系统

1. 数据库加乐观锁
2. 通过服务集群实现分流效果
3. 尽量将请求拦截在上游。
4. 还可以根据 UID 进行限流。
5. 最大程度的减少请求落到 DB。
6. 多利用缓存。使用redis缓存独写速度更快。
7. 同步操作异步化。
8. fail fast，尽早失败，保护应用。在提供真正商品秒杀业务功能的app server上，需要进行交易限流、熔断控制，防止因为秒杀交易影响到其他正常服务的提供，我们在限流和熔断方面使用了hystrix，在核心交易的controller层通过hystrix进行交易并发限流控制，当交易流量超出我们设定的限流最大值时，会对新交易进行熔断处理固定返回静态失败报文。
9. 配置静态活动页，避免加载过多资源

面试问到就想想自己看到的淘宝的场景。