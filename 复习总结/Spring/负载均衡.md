## 负载均衡

静态负载均衡算法包括：轮询，比率，优先权
动态负载均衡算法包括: 最少连接数,最快响应速度，观察方法，预测法，动态性能分配，动态服务器补充，服务质量，服务类型，规则模式。

## 静态负载均衡算法

  **轮询（Round Robin）**：顺序循环将请求一次顺序循环地连接每个服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从顺序循环队列中拿出，不参加下一次的轮询，直到其恢复正常。
  **比率（Ratio）**：给每个服务器分配一个加权值为比例，根椐这个比例，把用户的请求分配到每个服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配, 直到其恢复正常。
  **优先权（Priority）**：给所有服务器分组,给每个组定义优先权，BIG-IP 用户的请求，分配给优先级最高的服务器组（在同一组内，采用轮询或比率算法，分配用户的请求）；当最高优先级中所有服务器出现故障，BIG-IP 才将请求送给次优先级的服务器组。这种方式，实际为用户提供一种热备份的方式。

## 动态负载均衡算法

  **最少的连接方式（Least Connection）**：传递新的连接给那些进行最少连接处理的服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配, 直到其恢复正常。
  **最快模式（Fastest）**：传递连接给那些响应最快的服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。
  **观察模式（Observed）**：连接数目和响应时间以这两项的最佳平衡为依据为新的请求选择服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP就把其从服务器队列中拿出，不参加下一次的用户请求的分配，直到其恢复正常。
  **预测模式（Predictive）**：BIG-IP利用收集到的服务器当前的性能指标，进行预测分析，选择一台服务器在下一个时间片内，其性能将达到最佳的服务器相应用户的请求。(被BIG-IP 进行检测)
  **动态性能分配(Dynamic Ratio-APM)**:BIG-IP 收集到的应用程序和应用服务器的各项性能参数，动态调整流量分配。
  **动态服务器补充(Dynamic Server Act.):**当主服务器群中因故障导致数量减少时，动态地将备份服务器补充至主服务器群。
  **服务质量(QoS）:**按不同的优先级对数据流进行分配。
  **服务类型(ToS):** 按不同的服务类型（在Type of Field中标识）负载均衡对数据流进行分配。
  **规则模式**：针对不同的数据流设置导向规则，用户可自行。

### 负载均衡

负载均衡是一种计算机技术，用来在计算机集群、网络连接中分配负载，以达到最优化资源使用、最大化吞吐率、最小化响应时间，同时避免过载、单点，提高服务的高并发、高可靠、高可用。

负载均衡可分为本地负载均衡(一般局限于一定的区域范围内，其目标是在特定的区域范围内寻找一台最适合的节点提供服务。如在一个机房)和全局负载均衡（整个网络范围内，如上海集群和深圳集群）

#### 一致性哈希

一致性哈希在某些情况下如需要使用：

\- 会话粘连
支持多个上游网关在一次用户请求中分别调用同一个后台系统，且获得的返回是相同的。
所以需要依据用户的请求id，将多个网关的调用路由到后台系统的同一台机器上。
这也是在分布式服务场景下很常见的一致性hash负载均衡应用方式。

\- 有状态服务
对于一些数据相关的服务，比如缓存服务等，一般需要根据根据特定的KEY路由到具体的目标服务进行处理。